<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Matching Algorithms in R and C++: An Introduction to matchingR</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>
<style type="text/css">
a.anchor-section {margin-left: 10px; visibility: hidden; color: inherit;}
a.anchor-section::before {content: '#';}
.hasAnchor:hover a.anchor-section {visibility: visible;}
</style>
<script>// Anchor sections v1.0 written by Atsushi Yasumoto on Oct 3rd, 2020.
document.addEventListener('DOMContentLoaded', function() {
  // Do nothing if AnchorJS is used
  if (typeof window.anchors === 'object' && anchors.hasOwnProperty('hasAnchorJSLink')) {
    return;
  }

  const h = document.querySelectorAll('h1, h2, h3, h4, h5, h6');

  // Do nothing if sections are already anchored
  if (Array.from(h).some(x => x.classList.contains('hasAnchor'))) {
    return null;
  }

  // Use section id when pandoc runs with --section-divs
  const section_id = function(x) {
    return ((x.classList.contains('section') || (x.tagName === 'SECTION'))
            ? x.id : '');
  };

  // Add anchors
  h.forEach(function(x) {
    const id = x.id || section_id(x.parentElement);
    if (id === '') {
      return null;
    }
    let anchor = document.createElement('a');
    anchor.href = '#' + id;
    anchor.classList = ['anchor-section'];
    x.classList.add('hasAnchor');
    x.appendChild(anchor);
  });
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 800px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 20px;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 0;
padding: 4px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table:not([class]) {
margin: auto;
min-width: 40%;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table[summary="R argblock"] {
width: 100%;
border: none;
}
table:not([class]) th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table:not([class]) td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table:not([class]), table:not([class]) th, table:not([class]) td {
border-left-style: none;
border-right-style: none;
}
table:not([class]) tr.odd {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 13px;
padding-bottom: 1px;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f5f5f5;
border-radius: 3px;
color: #333;
}
pre {
overflow-x: auto;
border-radius: 3px;
margin: 5px 0 10px 0;
padding: 10px;
}
pre:not([class]) {
background-color: white;
border: #f5f5f5 1px solid;
}
pre:not([class]) code {
color: #444;
background-color: white;
}
code {
font-family: monospace;
font-size: 90%;
}
p > code, li > code {
padding: 2px 4px;
color: #d14;
border: 1px solid #e1e1e8;
white-space: inherit;
}
div.figure {
text-align: center;
}
table > caption, div.figure p.caption {
font-style: italic;
}
table > caption span, div.figure p.caption span {
font-style: normal;
font-weight: bold;
}
p {
margin: 0 0 10px;
}
table:not([class]) {
margin: auto auto 10px auto;
}
img:not([class]) {
background-color: #FFFFFF;
padding: 2px;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
max-width: 100%;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f5f5f5;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f5f5f5;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f5f5f5;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }
div.r-help-page {
background-color: #f9f9f9;
border-bottom: #ddd 1px solid;
margin-bottom: 10px;
padding: 10px;
}
div.r-help-page:hover {
background-color: #f4f4f4;
}

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Matching Algorithms in R and C++: An Introduction to matchingR</h1>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p><code>matchingR</code> is an R package which quickly computes the <a href="https://www.jstor.org/stable/2312726">Gale-Shapley algorithm</a> <span class="citation">(Gale and Shapley 1962)</span>, <a href="https://www.sciencedirect.com/science/article/pii/0196677485900331/">Irving’s algorithm for the stable roommate problem</a> <span class="citation">(Irving 1985)</span>, and the <a href="https://www.sciencedirect.com/science/article/abs/pii/0304406874900330/">top trading cycle algorithm</a> <span class="citation">(Shapley and Scarf 1973)</span> for large matching markets. The package provides functions to compute the solutions to the <a href="https://en.wikipedia.org/wiki/Stable_matching">stable marriage problem</a>, the <a href="https://en.wikipedia.org/wiki/Hospital_resident">college admission problem</a>, the <a href="https://en.wikipedia.org/wiki/Stable_roommates_problem">stable roommates problem</a>, and the <a href="https://web.stanford.edu/~niederle/HouseAllocation.pdf">house allocation problem</a>.</p>
<p>The package may be useful when the number of market participants is large or when many matchings need to be computed (e.g., for simulation or estimation purposes). It has been used in practice to compute the Gale-Shapley stable matching with 30,000 participants on each side of the market.</p>
<p>Matching markets are common in practice and widely studied by economists. Popular examples include</p>
<ul>
<li>the <a href="https://www.nrmp.org/">National Resident Matching Program</a> that matches graduates from medical school to residency programs at teaching hospitals throughout the United States</li>
<li>the matching of students to schools including the <a href="https://www.jstor.org/stable/4132848">New York City High School Match</a> or the the <a href="https://www.jstor.org/stable/4132849">Boston Public School Match</a> (and many more)</li>
<li>the matching of kidney donors to recipients in <a href="https://www.jstor.org/stable/4132851">kidney exchanges</a>.</li>
</ul>
</div>
<div id="two-sided-matching-markets-gale-shapley-algorithm" class="section level1">
<h1>Two-sided Matching Markets: Gale-Shapley Algorithm</h1>
<p>Consider the following marriage market: There are <code>N</code> men and <code>N</code> women. Each man, <code>m</code>, receives utility <code>uM(w, m)</code> from a match with woman <code>w</code>, and similarly each woman receives a payoff of <code>uW(m, w)</code> from being matched with a man.</p>
<p>A matching assigns men to women such that each man is assigned to one woman and each woman is assigned to one man. A matching is <strong>stable</strong> if there is no man and woman who would jointly prefer to be matched to each other over their current spouses. In other words, a matching is stable if there are no pairs <code>(m, w&#39;), (m&#39;, w)</code>, such that <code>m</code> is matched with <code>w&#39;</code>, <code>m&#39;</code> is matched with <code>w</code>, and both <code>uW(m, w) &gt; uW(m&#39;, w)</code> and <code>uM(m, w) &gt; uM(m, w&#39;)</code>.</p>
<p>For example, we might have preferences for men given by</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>uM =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="fl">1.0</span>, <span class="fl">0.5</span>, <span class="fl">0.0</span>,</span>
<span id="cb1-2"><a href="#cb1-2"></a>              <span class="fl">0.5</span>, <span class="fl">0.0</span>, <span class="fl">0.5</span>,</span>
<span id="cb1-3"><a href="#cb1-3"></a>              <span class="fl">0.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>), <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##          cols
## rows      Man 1 Man 2 Man 3
##   Woman 1   1.0   0.5   0.0
##   Woman 2   0.5   0.0   0.5
##   Woman 3   0.0   1.0   1.0</code></pre>
<p>In this example, man <code>1</code> receives a payoff of <code>1.0</code> from being matched to woman <code>1</code>, a payoff of <code>0.5</code> from being matched to woman <code>2</code> and a payoff of <code>0.0</code> from being matched to woman 3 (same logic applies to men <code>2</code> and <code>3</code>). Similarly, we might have preferences for women given by</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>uW =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="fl">0.0</span>, <span class="fl">1.0</span>, <span class="fl">0.0</span>,</span>
<span id="cb3-2"><a href="#cb3-2"></a>              <span class="fl">0.5</span>, <span class="fl">0.0</span>, <span class="fl">0.5</span>,</span>
<span id="cb3-3"><a href="#cb3-3"></a>              <span class="fl">1.0</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span>), <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##        cols
## rows    Woman 1 Woman 2 Woman 3
##   Man 1     0.0     1.0     0.0
##   Man 2     0.5     0.0     0.5
##   Man 3     1.0     0.5     1.0</code></pre>
<p>Here, columns in the matrix correspond to women, rows to men. In this example, woman <code>1</code> receives a payoff of <code>0.0</code> from being matched to man <code>1</code>, a payoff of <code>0.5</code> from being matched to man <code>2</code> and a payoff of <code>1.0</code> from being matched to man 3 (same logic applies to women <code>2</code> and <code>3</code>).</p>
<p>Instead of using payoff matrices, we can also represent preferences using preference orderings. The preference ordering that corresponds to <code>uM</code> is</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>prefM =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>,</span>
<span id="cb5-2"><a href="#cb5-2"></a>                 <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>,</span>
<span id="cb5-3"><a href="#cb5-3"></a>                 <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##         cols
## rows     Man 1 Man 2 Man 3
##   Rank 1     1     3     3
##   Rank 2     2     1     2
##   Rank 3     3     2     1</code></pre>
<p><code>prefM</code> states that man <code>1</code> prefers woman <code>1</code> over woman <code>2</code> over woman <code>3</code>, etc. The preference ordering that corresponds to <code>uW</code> is given by</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>prefW =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>,</span>
<span id="cb7-2"><a href="#cb7-2"></a>                 <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>,</span>
<span id="cb7-3"><a href="#cb7-3"></a>                 <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##         cols
## rows     Woman 1 Woman 2 Woman 3
##   Rank 1       3       1       3
##   Rank 2       2       3       2
##   Rank 3       1       2       1</code></pre>
<p>The matching algorithm discussed below can take either payoff matrices of the type <code>uM</code> and <code>uW</code> or preference orderings of the type <code>prefM</code> and <code>prefW</code> as arguments.</p>
<p>The Gale-Shapley algorithm works as follows: Single men (“the proposers”) sequentially make proposals to each of their most preferred available women (“the reviewers”). A woman can hold on to at most one proposal at a time. A <em>single</em> woman will accept any proposal that is made to her. A woman who already has a proposal will reject any proposal she values less than her current proposal in hand. If a woman receives a proposal from a man that she values more than her current proposal, she will accept the proposal and her previous match will rejoin the line of proposers. This process continues until all men are matched to all women.</p>
<p>For the preferences specified in <code>uM</code> and <code>uW</code>, we can compute the Gale-Shapley Algorithm by hand. Initially, all men are single.</p>
<ol style="list-style-type: decimal">
<li><ul>
<li>Man <code>1</code> proposes to woman <code>1</code>, his most-preferred choice.</li>
<li>Unmatched men: <code>2</code>, <code>3</code></li>
</ul></li>
<li><ul>
<li>Man <code>2</code> proposes to woman <code>3</code>, his most-preferred choice.</li>
<li>Unmatched men: <code>3</code></li>
</ul></li>
<li><ul>
<li>Man <code>3</code> proposes to woman <code>3</code>, his most-preferred choice.</li>
<li>Woman <code>3</code> now dumps man <code>2</code>.</li>
<li>Unmatched men: <code>2</code></li>
</ul></li>
<li><ul>
<li>Man <code>2</code> proposes to woman <code>1</code>, his most-preferred available choice.</li>
<li>Woman <code>1</code> now dumps man <code>1</code>.</li>
<li>Unmatched men: <code>1</code></li>
</ul></li>
<li><ul>
<li>Man <code>1</code> proposes to woman <code>2</code>, his most-preferred available choice.</li>
<li>All men are now matched.</li>
</ul></li>
</ol>
<p>The man-optimal stable matching is therefore:</p>
<table>
<thead>
<tr class="header">
<th>Man</th>
<th>Woman</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
</tr>
<tr class="odd">
<td>3</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>The package computes the Gale-Shapley algorithm using the function <code>galeShapley.marriageMarket</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>matching =<span class="st"> </span><span class="kw">galeShapley.marriageMarket</span>(uM, uW)</span></code></pre></div>
<p>Note that we can obtain equivalent results when we use <code>prefM</code> and <code>prefW</code> as arguments:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>matching =<span class="st"> </span><span class="kw">galeShapley.marriageMarket</span>(<span class="dt">proposerPref =</span> prefM, <span class="dt">reviewerPref =</span> prefW)</span></code></pre></div>
<p>The function <code>galeShapley.marriageMarket</code> returns a list <code>matching</code> that includes the vectors <code>proposals</code> and <code>engagements</code> with the final proposals and engagements, respectively. These two vectors contain the same information (i.e. they tell us who is matched with whom). For the example above, the vector of proposals contains</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>matching<span class="op">$</span>proposals</span></code></pre></div>
<pre><code>##        cols
## rows    Proposed to Woman
##   Man 1                 2
##   Man 2                 1
##   Man 3                 3</code></pre>
<p>The first element in the vector tells us that man <code>1</code> is matched with woman <code>2</code>. Man <code>2</code> is matched to woman <code>1</code>, and man <code>3</code> is matched to woman <code>3</code>. The vector of engagement contains</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>matching<span class="op">$</span>engagements</span></code></pre></div>
<pre><code>##          cols
## rows      Engaged to Man
##   Woman 1              2
##   Woman 2              1
##   Woman 3              3</code></pre>
<p>The first element in the vector tells us that woman <code>1</code> is matched to man <code>2</code>, woman <code>2</code> will be matched to man <code>1</code>, and woman <code>3</code> will be matched to man <code>3</code>.</p>
<p>We can then check if the computed matching is stable using the function <code>checkStability</code>. To check if a matching is stable, we check for each assignment <code>(m,w)</code> if there is some other woman <code>w&#39;</code> that man <code>m</code> would rather be matched with and who would rather be matched to man <code>m</code>. This function will return <code>true</code> if the matching is stable and <code>false</code> otherwise.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">galeShapley.checkStability</span>(uM, uW, matching<span class="op">$</span>proposals, matching<span class="op">$</span>engagements)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>For the simple 3-by-3 example, we can perform this check by hand:</p>
<ul>
<li>Man <code>1</code> is matched to woman <code>2</code>, his second-most preferred choice. His most preferred choice is woman <code>1</code>. Woman <code>1</code> is matched with man <code>2</code> who she prefers over man <code>1</code>. Thus man <code>1</code> cannot do better than woman <code>2</code>.</li>
<li>Man <code>2</code> is matched to woman <code>1</code>, his second-most preferred choice. His most preferred woman is woman <code>3</code>, who is matched with man <code>3</code>. Since man <code>3</code> is her most-preferred choice, man <code>2</code> cannot do better than woman <code>1</code>.</li>
<li>Man <code>3</code> is matched to women <code>3</code>, his most preferred choice, so he cannot do better.</li>
</ul>
<p>Thus, this matching is stable.</p>
<p>The following examples illustrate some additional features of this package.</p>
<div id="example-marriage-market" class="section level3">
<h3>Example: Marriage Market</h3>
<p>The following is an example of <code>galeShapley.marriageMarket</code> with different numbers of participants on each side of the market. There are 2,500 women and 2,000 men. By construction, 500 men will remain unmatched. We randomly generate payoff matrices <code>uM</code> and <code>uW</code> which are drawn from a uniform distribution (<code>runif</code>). We then compute the male-optimal (i.e. men are proposing) and the female-optimal (i.e. woman are proposing) matching.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># set seed</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="co"># set number of men</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>nmen =<span class="st"> </span><span class="dv">2500</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="co"># set number of women</span></span>
<span id="cb17-6"><a href="#cb17-6"></a>nwomen =<span class="st"> </span><span class="dv">2000</span></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="co"># generate preferences</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>uM =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(nmen<span class="op">*</span>nwomen), <span class="dt">nrow =</span> nwomen, <span class="dt">ncol =</span> nmen)</span>
<span id="cb17-9"><a href="#cb17-9"></a>uW =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(nmen<span class="op">*</span>nwomen), <span class="dt">nrow =</span> nmen, <span class="dt">ncol =</span> nwomen)</span>
<span id="cb17-10"><a href="#cb17-10"></a><span class="co"># male-optimal matching</span></span>
<span id="cb17-11"><a href="#cb17-11"></a>resultsM =<span class="st"> </span><span class="kw">galeShapley.marriageMarket</span>(uM, uW)</span>
<span id="cb17-12"><a href="#cb17-12"></a><span class="kw">str</span>(resultsM)</span></code></pre></div>
<pre><code>## List of 4
##  $ proposals       : num [1:2500, 1] 927 1644 1965 1851 349 ...
##  $ engagements     : num [1:2000, 1] 386 471 1582 598 1657 ...
##  $ single.proposers: num [1:500] 8 11 17 19 26 30 34 37 49 53 ...
##  $ single.reviewers: num(0)</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">galeShapley.checkStability</span>(uM, uW, resultsM<span class="op">$</span>proposals, resultsM<span class="op">$</span>engagements)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># female-optimal matching</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>resultsW =<span class="st"> </span><span class="kw">galeShapley.marriageMarket</span>(uW, uM)</span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="kw">str</span>(resultsW)</span></code></pre></div>
<pre><code>## List of 4
##  $ proposals       : num [1:2000, 1] 386 471 1582 598 1657 ...
##  $ engagements     : num [1:2500, 1] 927 1644 1965 1851 349 ...
##  $ single.proposers: num(0) 
##  $ single.reviewers: num [1:500] 8 11 17 19 26 30 34 37 49 53 ...</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">galeShapley.checkStability</span>(uW, uM, resultsW<span class="op">$</span>proposals, resultsW<span class="op">$</span>engagements)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="example-college-admissions-problem" class="section level3">
<h3>Example: College Admissions Problem</h3>
<p>The following is an example of <code>galeShapley.collegeAdmissions</code> where 1000 students get matched to 400 colleges, where each college has two slots. By construction, 200 students will remain unmatched. We draw students’ and colleges’ preferences, <code>uStudents</code> and <code>uColleges</code>, respectively, by from a uniform distribution.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># set seed</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="co"># set number of students</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>nstudents =<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="co"># set number of colleges</span></span>
<span id="cb25-6"><a href="#cb25-6"></a>ncolleges =<span class="st"> </span><span class="dv">400</span></span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="co"># generate preferences</span></span>
<span id="cb25-8"><a href="#cb25-8"></a>uStudents =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(ncolleges<span class="op">*</span>nstudents), <span class="dt">nrow =</span> ncolleges, <span class="dt">ncol =</span> nstudents)</span>
<span id="cb25-9"><a href="#cb25-9"></a>uColleges =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(nstudents<span class="op">*</span>ncolleges), <span class="dt">nrow =</span> nstudents, <span class="dt">ncol =</span> ncolleges)</span>
<span id="cb25-10"><a href="#cb25-10"></a><span class="co"># student-optimal matching</span></span>
<span id="cb25-11"><a href="#cb25-11"></a>results =<span class="st"> </span><span class="kw">galeShapley.collegeAdmissions</span>(<span class="dt">studentUtils =</span>  uStudents, <span class="dt">collegeUtils =</span>  uColleges, <span class="dt">slots =</span> <span class="dv">2</span>)</span>
<span id="cb25-12"><a href="#cb25-12"></a><span class="kw">str</span>(results)</span></code></pre></div>
<pre><code>## List of 4
##  $ unmatched.students: num [1:200] 3 15 23 29 30 36 44 46 48 49 ...
##  $ unmatched.colleges: int(0) 
##  $ matched.colleges  : num [1:400, 1:2] 728 887 28 372 875 775 456 937 402 774 ...
##  $ matched.students  : int [1:1000, 1] 52 70 NA 210 155 170 238 16 371 391 ...</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># check if matching is stable</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="kw">galeShapley.checkStability</span>(uStudents, uColleges, results<span class="op">$</span>matched.students, results<span class="op">$</span>matched.colleges)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
</div>
<div id="one-sided-matching-markets-irvings-algorithm" class="section level1">
<h1>One-sided Matching Markets: Irving’s Algorithm</h1>
<p>This package implements the algorithm by <span class="citation">Irving (1985)</span> for one-sided matching markets.</p>
<p>Consider the following example: A set of <code>n</code> potential roommates, each with ranked preferences over all the other potential roommates, are to be matched to rooms, two roommates per room. A matching is <strong>stable</strong> if there is no roommate <code>r1</code> that would rather be matched to some other roommate <code>d2</code> than to his current roommate <code>r2</code> and the other roommate <code>d2</code> would rather be matched to <code>r1</code> than to his current roommate <code>d1</code>.</p>
<p>Preferences of potential roommates are summarized by an <span class="math inline">\(n-1 \times n\)</span> dimensional matrix, e.g., if <span class="math inline">\(n = 6\)</span>,</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>pref =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">5</span>,</span>
<span id="cb29-2"><a href="#cb29-2"></a>                <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb29-3"><a href="#cb29-3"></a>                <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>,</span>
<span id="cb29-4"><a href="#cb29-4"></a>                <span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">4</span>, <span class="dv">4</span>,</span>
<span id="cb29-5"><a href="#cb29-5"></a>                <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">2</span>), <span class="dt">nrow =</span> <span class="dv">5</span>, <span class="dt">ncol =</span> <span class="dv">6</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>Column <code>i</code> represents the preferences of the <code>i</code>th roommate, and row <code>j</code> represents the ranking of the roommate whose index is encoded in that row. For example, in the above preference matrix, roommate <code>1</code> most prefers to be matched with roommate <code>3</code>, followed by <code>4</code>, followed by <code>2</code>.</p>
<p>The function <code>roommate.checkPreferences</code> checks if a given preference order is complete, i.e. if all preferences are fully specified. If the preference order is complete, it will return the proper preference order using <code>C++</code> style indexing (beginning at <code>0</code> instead of at <code>1</code>). If the preference order is incomplete, the function will return an error.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw">roommate.checkPreferences</span>(pref)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6]
## [1,]    2    5    1    4    2    4
## [2,]    3    4    3    1    0    0
## [3,]    1    3    4    2    1    2
## [4,]    5    0    0    5    3    3
## [5,]    4    2    5    0    5    1</code></pre>
<p>The algorithm proceeds in two phases.</p>
<p>In phase 1, potential roommates take turns sequentially proposing to the other roommates. Each roommate who is proposed to can accept or reject the proposal. A roommate accepts if he currently has made no better proposal which was accepted to another roommate. If a roommate has accepted a proposal, and then receives a better proposal, he rejects the old proposal and substitutes in the new proposal.</p>
<p>In the above example,</p>
<ol style="list-style-type: decimal">
<li>Roommate <code>1</code> begins by proposing to roommate <code>3</code>, his most preferred roommate. <code>3</code>, having no better offers, accepts.</li>
<li><code>2</code> proposes to <code>6</code>, who accepts.</li>
<li><code>3</code> proposes to <code>2</code>, who accepts.</li>
<li><code>4</code> proposes to <code>5</code>, who accepts.</li>
<li><code>5</code> proposes to <code>3</code>, who accepts. <code>3</code> cancels his proposal from <code>1</code>.</li>
<li><code>1</code>, having no proposal, proposes to <code>4</code>, who accepts.</li>
<li><code>6</code> proposes to <code>5</code>, who rejects, having a better proposal from <code>4</code>.</li>
<li><code>6</code> proposes to <code>1</code>, who accepts.</li>
</ol>
<p>In phase 2, we begin by eliminating all potential roommate matches which are worse than the current proposals held. For example, in the above example, <code>3</code> has a proposal from <code>5</code>, and so we eliminate <code>1</code> and <code>6</code> from <code>3</code>‘s column, and symmetrically eliminate <code>3</code> from <code>1</code> and <code>6</code>’s column. This results in the following ’reduced’ preference listing:</p>
<pre><code>   6, 2, 5, 3,  
4, 5, 4, 2,    1
2, 4, 5, 3, 2,  
6, 1,    6, 4, 4
   3,    1,    2</code></pre>
<p>These preferences form what is called a ‘stable’ table, or, ‘s-table’. (‘Stable’ for short.) The defining characteristic of a stable table is that if <code>i</code> is the most preferred roommate on <code>j</code>s list, then <code>j</code> is the least preferred roommate on <code>i</code>s list. For example, <code>1</code> most prefers <code>4</code>, but <code>4</code> least prefers <code>1</code>.</p>
<p>The algorithm proceeds by finding and eliminating ‘rotations’. A rotation is a sequence of pairs of roommates, such that there is a distinct roommate in the first position of each pair, the second roommate in each pair least prefers the roommate he is paired with, the first roommate in each pair most prefers the roommate he is paired with, and finally, the first roommate in each pair ranks the second roommate in the following pair second (modulo the number of pairs, that is, the first roommate in the last pair ranks the second roommate in the first pair second) Once a rotation has been identified, removing it results in another stable table.</p>
<p>For example, <code>(1, 4), (3, 2)</code> is a rotation in the above table, because <code>1</code> loves <code>4</code>, <code>3</code> loves <code>2</code>, <code>4</code> hates <code>1</code>, <code>2</code> hates <code>3</code>, <code>2</code> is second on <code>1</code>s list, and <code>4</code> is second on <code>3</code>’s list. Eliminating this rotation involves <code>2</code> rejecting <code>3</code>, <code>4</code> rejecting <code>1</code>, and then we remove every successive potential roommate as well to preserve the stable table property, resulting in</p>
<pre><code>   6,    5, 3,  
   5, 4, 2,    1
2, 4, 5, 3, 2,  
6, 1,    6, 4, 4
               2</code></pre>
<p>A further rotation is <code>(1, 2), (2, 6), (4, 5)</code>. Eliminating it yields</p>
<pre><code>            3,  
   5, 4, 2,    1
   4, 5, 3, 2,  
6,</code></pre>
<p>A final rotation is <code>(2, 5), (3, 4)</code>. Eliminating it yields</p>
<pre><code>            3,  
         2,    1
   4, 5,
6,
</code></pre>
<p>Therefore, a stable matching is for <code>1</code> and <code>6</code> to match, <code>2</code> and <code>4</code> to match, and <code>3</code> and <code>5</code> to match.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>results =<span class="st"> </span><span class="kw">roommate</span>(<span class="dt">pref =</span> pref)</span>
<span id="cb36-2"><a href="#cb36-2"></a>results</span></code></pre></div>
<pre><code>##      [,1]
## [1,]    6
## [2,]    4
## [3,]    5
## [4,]    2
## [5,]    3
## [6,]    1</code></pre>
<p>The function <code>roommate.checkStability</code> can be used to check if the resulting matching is stable:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="kw">roommate.checkStability</span>(<span class="dt">pref =</span> pref, <span class="dt">matching =</span> results)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div id="example-roommate-problem" class="section level3">
<h3>Example: Roommate problem</h3>
<p>The function <code>roommate</code> can also be called using a payoff matrix, <code>u</code>, to specify preferences. In <code>u</code>, the element <code>[i,j]</code> refers to the payoff that agent <code>j</code> gets from being matched to agent <code>i</code>. The main diagonal of this matrix contains no information and will be removed by the algorithm.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># generate preferences</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>N =<span class="st"> </span><span class="dv">10</span></span>
<span id="cb40-3"><a href="#cb40-3"></a>u =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(N<span class="op">^</span><span class="dv">2</span>),  <span class="dt">nrow =</span> N, <span class="dt">ncol =</span> N)</span>
<span id="cb40-4"><a href="#cb40-4"></a>results =<span class="st"> </span><span class="kw">roommate</span>(<span class="dt">utils =</span> u)</span>
<span id="cb40-5"><a href="#cb40-5"></a>results</span></code></pre></div>
<pre><code>##       [,1]
##  [1,]    3
##  [2,]    4
##  [3,]    1
##  [4,]    2
##  [5,]    7
##  [6,]   10
##  [7,]    5
##  [8,]    9
##  [9,]    8
## [10,]    6</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="kw">roommate.checkStability</span>(<span class="dt">utils =</span> u, <span class="dt">matching =</span> results)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="example-roommate-problem-when-no-stable-matching-exists" class="section level3">
<h3>Example: Roommate problem when no stable matching exists</h3>
<p>Note that in the roommate problem, existence of a stable matching is not guaranteed. When no stable matching can be found, the function <code>roommate</code> returns <code>NULL</code>.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb44-2"><a href="#cb44-2"></a>N =<span class="st"> </span><span class="dv">512</span></span>
<span id="cb44-3"><a href="#cb44-3"></a>u =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(N<span class="op">^</span><span class="dv">2</span>),  <span class="dt">nrow =</span> N, <span class="dt">ncol =</span> N)</span>
<span id="cb44-4"><a href="#cb44-4"></a>results =<span class="st"> </span><span class="kw">roommate</span>(<span class="dt">utils =</span> u)</span>
<span id="cb44-5"><a href="#cb44-5"></a><span class="kw">print</span>(results)</span></code></pre></div>
<pre><code>## NULL</code></pre>
</div>
</div>
<div id="kidneys-and-housing-the-top-trading-cycle-algorithm" class="section level1">
<h1>Kidneys and Housing: The Top Trading Cycle Algorithm</h1>
<p>This package implements the top trading cycle algorithm.</p>
<p>Consider the following problem: A set of <span class="math inline">\(n\)</span> agents each currently own their own home, and have preferences over the homes of other agents. The problem is to trade the homes between the agents in such a way so that no two agents want to swap homes.</p>
<p>Preferences of agents are summarized by an <span class="math inline">\(n \times n\)</span> dimensional matrix, e.g., if <span class="math inline">\(n = 4\)</span>,</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>pref =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">4</span>,</span>
<span id="cb46-2"><a href="#cb46-2"></a>                <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb46-3"><a href="#cb46-3"></a>                <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>,</span>
<span id="cb46-4"><a href="#cb46-4"></a>                <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">2</span>), <span class="dt">nrow =</span> <span class="dv">4</span>, <span class="dt">ncol =</span> <span class="dv">4</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>Column <span class="math inline">\(i\)</span> represents the preferences of the <span class="math inline">\(i\)</span>th agent, and row <span class="math inline">\(j\)</span> represents the ranking of the roommate whose index is encoded in that row. For example, in the above preference matrix, agent <code>1</code> most prefers the home of agent <code>4</code>, followed by <code>2</code>, followed by <code>1</code>, followed by <code>3</code>.</p>
<p>Roughly speaking, the top trading cycle proceeds by identifying cycles of agents, then eliminating those cycles until no agents remain. A cycle is a sequence of agents such that each agent most prefers the next agent’s home (out of the remaining unmatched agents), and the last agent in the sequence most prefers the first agent in the sequence’s home.</p>
<pre><code>4,  4,  2,  4
2,  1,  1,  1
1,  2,  3,  3
3,  3,  4,  2</code></pre>
<p>For example, for the above preference matrix, when all the agents are unmatched, the only rotation is <span class="math inline">\(\{4\}\)</span>, representing the fact that agent <code>4</code> most prefers his own house. Therefore, the algorithm begins by matching agent <code>4</code> to himself, and then removing him from the pool:</p>
<pre><code>        2
2,  1,  1
1,  2,  3
3,  3,</code></pre>
<p>Now, a rotation is <span class="math inline">\(\{1, 2\}\)</span>, because <code>1</code> most prefers <code>2</code>s house, and <code>2</code> most prefers <code>1</code>s house. So agents <code>1</code> and <code>2</code> will swap homes, leaving agent <code>3</code> all by himself.</p>
<pre><code>

        3
</code></pre>
<p>Therefore, the final matching is that agent <code>1</code> swaps with agent <code>2</code>, and agents <code>3</code> and <code>4</code> keep their own homes.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>results =<span class="st"> </span><span class="kw">toptrading</span>(<span class="dt">pref =</span> pref)</span>
<span id="cb50-2"><a href="#cb50-2"></a>results</span></code></pre></div>
<pre><code>##      [,1]
## [1,]    2
## [2,]    1
## [3,]    3
## [4,]    4</code></pre>
<p>The function <code>toptrading.checkStability</code> can be used to check if the resulting allocation is in fact stable:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="kw">toptrading.checkStability</span>(<span class="dt">pref =</span> pref, <span class="dt">matchings =</span> results)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="literature" class="section level1 unnumbered">
<h1>Literature</h1>
<div id="refs" class="references">
<div id="ref-gale1962college">
<p>Gale, D., and L. Shapley. 1962. “College Admissions and the Stability of Marriage.” <em>American Mathematical Monthly</em> 69 (1): 9–15.</p>
</div>
<div id="ref-irving1985roommates">
<p>Irving, R. 1985. “An Efficient Algorithm for the &quot;Stable Roommates&quot; Problem.” <em>Journal of Algorithms</em> 6 (4): 577–95.</p>
</div>
<div id="ref-shapley1973cores">
<p>Shapley, L., and H. Scarf. 1973. “On Cores and Indivisibility.” <em>Journal of Mathematical Economics</em> 1 (1): 23–37.</p>
</div>
</div>
</div>

<script type="text/javascript">
window.onload = function() {
  var i, fig = 1, caps = document.getElementsByClassName('caption');
  for (i = 0; i < caps.length; i++) {
    var cap = caps[i];
    if (cap.parentElement.className !== 'figure' || cap.nodeName !== 'P')
      continue;
    cap.innerHTML = '<span>Figure ' + fig + ':</span> ' + cap.innerHTML;
    fig++;
  }
  fig = 1;
  caps = document.getElementsByTagName('caption');
  for (i = 0; i < caps.length; i++) {
    var cap = caps[i];
    if (cap.parentElement.nodeName !== 'TABLE') continue;
    cap.innerHTML = '<span>Table ' + fig + ':</span> ' + cap.innerHTML;
    fig++;
  }
}
</script>


<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
